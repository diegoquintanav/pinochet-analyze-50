version: '3.4'

services:
  ontop:
    image: ghcr.io/diegoquintanav/pinochet-sparql-ontop:latest
    build:
      context: services/ontop
      dockerfile: Dockerfile
    environment:
      ONTOP_ONTOLOGY_FILE: /opt/ontop/input/mapping.protege.ttl
      ONTOP_MAPPING_FILE: /opt/ontop/input/mapping.protege.obda
      ONTOP_PROPERTIES_FILE: /opt/ontop/input/mapping.protege.properties
      ONTOP_PORTAL_FILE: /opt/ontop/input/mapping.protege.portal.toml
      ONTOP_CORS_ALLOWED_ORIGINS: "*"
      ONTOP_DEV_MODE: "true"
      ONTOP_DB_USER: ${ONTOP_DB_USER-postgres}
      ONTOP_DB_PASSWORD: ${ONTOP_DB_PASSWORD-postgres}
      ONTOP_DB_URL: ${ONTOP_DB_URL-jdbc:postgresql://postgis:5432/pinochet}
      ONTOP_DB_DRIVER: ${ONTOP_DB_DRIVER-org.postgresql.Driver}
    volumes:
      # files needed by ontop to map the ontology to the db
      - ./services/ontop/input:/opt/ontop/input
      # postgres jdbc driver to connect to postgis
      - ./services/ontop/jdbc:/opt/ontop/jdbc
    ports:
      - "8083:8080"
